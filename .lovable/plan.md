

# AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ –æ–±—É—á–µ–Ω–∏—é, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤ hakku.lms

## –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–ì–ª–æ–±–∞–ª—å–Ω—ã–π AI-–ø–æ–º–æ—â–Ω–∏–∫, –¥–æ—Å—Ç—É–ø–Ω—ã–π —Å –ª—é–±–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã LMS —á–µ—Ä–µ–∑ –ø–ª–∞–≤–∞—é—â—É—é –∫–Ω–æ–ø–∫—É (FAB). –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç: –Ω–∞ –∫–∞–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–∞–∫–æ–π –∫—É—Ä—Å/—É—Ä–æ–∫ –æ—Ç–∫—Ä—ã—Ç, –∫–∞–∫–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å -- –∏ –¥–∞—ë—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏.

```text
+------------------------------------------+
|  Layout (–ª—é–±–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)                  |
|                                          |
|  [–∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã]                      |
|                                          |
|                              [ü§ñ FAB]    |
+------------------------------------------+
         |
         v  (–∫–ª–∏–∫)
+------------------------------------------+
| AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç                    [x]      |
|------------------------------------------|
| –ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è             |
| –≤ –º–∞—Ç–µ—Ä–∏–∞–ª–∞—Ö –∫—É—Ä—Å–∞.                      |
|                                          |
| [–°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞]                         |
|                                          |
|------------------------------------------|
| [–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å...]          [–û—Ç–ø—Ä–∞–≤–∏—Ç—å] |
+------------------------------------------+
```

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

### –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –æ—Å–≤–µ–¥–æ–º–ª—ë–Ω–Ω–æ—Å—Ç—å

–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ —Ç–µ–∫—É—â–µ–º—É URL:

| –°—Ç—Ä–∞–Ω–∏—Ü–∞ | –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è AI |
|----------|-----------------|
| `/course/:slug/lesson/:id` | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–∫—É—â–µ–≥–æ —É—Ä–æ–∫–∞ (content_json) |
| `/course/:slug` | –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞, —Å–ø–∏—Å–æ–∫ –º–æ–¥—É–ª–µ–π |
| `/my-progress` | –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–∞—Ä—Ç–∞ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–π |
| `/catalog` | –ü–æ–º–æ—â—å –≤ –≤—ã–±–æ—Ä–µ –∫—É—Ä—Å–∞ |
| `/` (–≥–ª–∞–≤–Ω–∞—è) | –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã, –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ LMS |
| `/task/*` | –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è |

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ —É—Ä–æ–∫–∞
- –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ç–µ–º–µ –∫—É—Ä—Å–∞
- –ü–æ–º–æ—â—å —Å –¥–æ–º–∞—à–Ω–∏–º–∏ –∑–∞–¥–∞–Ω–∏—è–º–∏ (–Ω–∞–≤–æ–¥—è—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã, –Ω–µ –ø—Ä—è–º—ã–µ –æ—Ç–≤–µ—Ç—ã)
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, —á—Ç–æ –∏–∑—É—á–∞—Ç—å –¥–∞–ª—å—à–µ
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ LMS ("–≥–¥–µ –Ω–∞–π—Ç–∏ X?")

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ù–æ–≤—ã–π edge function: `supabase/functions/learning-assistant/index.ts`

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Lovable AI Gateway (`ai.gateway.lovable.dev`)
- –ú–æ–¥–µ–ª—å: `google/gemini-3-flash-preview`
- –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤–∫–ª—é—á–∞–µ—Ç —Ä–æ–ª—å –æ–±—É—á–∞—é—â–µ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `context` (–æ–±—ä–µ–∫—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ, —É—Ä–æ–∫–µ, –∫—É—Ä—Å–µ)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç streaming (SSE) –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ 429/402

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| `supabase/functions/learning-assistant/index.ts` | Edge function -- –ø—Ä–æ–∫—Å–∏ –∫ Lovable AI —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º |
| `src/components/AiAssistant.tsx` | –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ + –≤—ã–¥–≤–∏–∂–Ω–∞—è –ø–∞–Ω–µ–ª—å —á–∞—Ç–∞ |
| `src/hooks/useAiAssistant.ts` | –•—É–∫: streaming, –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |

### –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| `src/components/Layout.tsx` | –î–æ–±–∞–≤–∏—Ç—å `<AiAssistant />` –≤ Layout |
| `supabase/config.toml` | –î–æ–±–∞–≤–∏—Ç—å `[functions.learning-assistant]` |

### UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `AiAssistant.tsx`

**–ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ (FAB):**
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è: –ø—Ä–∞–≤—ã–π –Ω–∏–∂–Ω–∏–π —É–≥–æ–ª (–Ω–∞–¥ bottom nav –Ω–∞ –º–æ–±–∏–ª–µ)
- –ò–∫–æ–Ω–∫–∞ `MessageCircle` / `Bot`
- –ê–Ω–∏–º–∞—Ü–∏—è pulse –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∏–∑–∏—Ç–µ
- Badge —Å —Ç–æ—á–∫–æ–π, –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ

**–ü–∞–Ω–µ–ª—å —á–∞—Ç–∞ (Sheet/Drawer):**
- –ù–∞ –º–æ–±–∏–ª–µ: Sheet —Å–Ω–∏–∑—É (70vh)
- –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å–ø—Ä–∞–≤–∞ (400px —à–∏—Ä–∏–Ω–æ–π)
- –ó–∞–≥–æ–ª–æ–≤–æ–∫: "AI-–ø–æ–º–æ—â–Ω–∏–∫" + –∏–∫–æ–Ω–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
- –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π —Å auto-scroll
- Markdown-—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –æ—Ç–≤–µ—Ç–æ–≤ AI (renderFormattedText)
- –°—Ç—Ä–æ–∫–∞ –≤–≤–æ–¥–∞ + –∫–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
- Streaming: —Ç–æ–∫–µ–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ –º–µ—Ä–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è

### –•—É–∫ `useAiAssistant.ts`

```text
- messages: –º–∞—Å—Å–∏–≤ {role, content, timestamp}
- isOpen: —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∞–Ω–µ–ª–∏
- isStreaming: –∏–¥—ë—Ç –ª–∏ —Å—Ç—Ä–∏–º–∏–Ω–≥
- sendMessage(text): –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- buildContext(): –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ useLocation()
- clearChat(): –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
```

–ö–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ç—Ä–æ–∏—Ç—Å—è —Ç–∞–∫:
- –ë–µ—Ä—ë–º `location.pathname`
- –ï—Å–ª–∏ `/course/:slug/lesson/:id` -- –ø–æ–¥–≥—Ä—É–∂–∞–µ–º content_json —É—Ä–æ–∫–∞ —á–µ—Ä–µ–∑ –∫–µ—à React Query
- –ï—Å–ª–∏ `/course/:slug` -- –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞
- –ï—Å–ª–∏ –¥—Ä—É–≥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -- –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (–Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞)

### Edge function: streaming —á–µ—Ä–µ–∑ Lovable AI

–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–∑–∞–¥–∞—ë—Ç—Å—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ):

```text
–¢—ã -- AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã hakku.ai.
–ü–æ–º–æ–≥–∞–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —É—á–µ–±–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–∞—Ö.
–û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ —Å—É—â–µ—Å—Ç–≤—É.
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ –¥–æ–º–∞—à–Ω–µ–º—É –∑–∞–¥–∞–Ω–∏—é -- –∑–∞–¥–∞–≤–∞–π –Ω–∞–≤–æ–¥—è—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã, –Ω–µ –¥–∞–≤–∞–π –≥–æ—Ç–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤.
–ò—Å–ø–æ–ª—å–∑—É–π markdown –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
–ö–æ–Ω—Ç–µ–∫—Å—Ç —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏.
```

### –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. –°–æ–∑–¥–∞—Ç—å edge function `learning-assistant` (streaming —á–µ—Ä–µ–∑ Lovable AI)
2. –û–±–Ω–æ–≤–∏—Ç—å `config.toml`
3. –°–æ–∑–¥–∞—Ç—å —Ö—É–∫ `useAiAssistant`
4. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `AiAssistant` (FAB + Sheet)
5. –í—Å—Ç—Ä–æ–∏—Ç—å –≤ `Layout.tsx`

